# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/spi/spi-fsl-lpspi.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Freescale Low Power SPI (LPSPI) for i.MX

maintainers:
  - Anson Huang <Anson.Huang@nxp.com>

allOf:
  - $ref: "/schemas/spi/spi-controller.yaml#"

properties:
  compatible:
    enum:
      - fsl,imx7ulp-spi
      - fsl,imx8qxp-spi
      - nxp,s32g-lpspi

  reg:
    maxItems: 1

  interrupts:
    maxItems: 1

  clocks:
    items:
      - description: SoC SPI per clock
      - description: SoC SPI ipg clock

  clock-names:
    items:
      - const: per
      - const: ipg

  fsl,spi-only-use-cs1-sel:
    description:
      spi common code does not support use of CS signals discontinuously.
      i.MX8DXL-EVK board only uses CS1 without using CS0. Therefore, add
      this property to re-config the chipselect value in the LPSPI driver.
    type: boolean

  nxp,reset-at-underrun:
    description:
        In S32G3 case, TX FIFO pointers are corrupted when a transmit FIFO
        underrun occurs in slave mode (ERR051588). The workaround is to reset
        the TX FIFO before writing any new data.
    type: boolean

  pinctrl-0:
    description:
      A phandle to the default pinctrl state.

  pinctrl-1:
    description:
      A phandle to the slave pinctrl state if the default state is used for the
      master.

  pinctrl-names:
    items:
      - const: default
      - const: slave
    description:
      A pinctrl state named "default" will be applied if defined. Pinctrl
      state named "slave" will be applied if defined and if the controller
      is configured as slave.

required:
  - compatible
  - reg
  - clocks
  - clock-names

oneOf:
  - required:
      - interrupts
  - required:
      - interrupts-extended

unevaluatedProperties: false

examples:
  - |
    #include <dt-bindings/clock/imx7ulp-clock.h>
    #include <dt-bindings/interrupt-controller/arm-gic.h>

    spi@40290000 {
        compatible = "fsl,imx7ulp-spi";
        reg = <0x40290000 0x10000>;
        interrupt-parent = <&intc>;
        interrupts = <GIC_SPI 28 IRQ_TYPE_LEVEL_HIGH>;
        clocks = <&clks IMX7ULP_CLK_LPSPI2>,
                 <&clks IMX7ULP_CLK_DUMMY>;
        clock-names = "per", "ipg";
        spi-slave;
        fsl,spi-only-use-cs1-sel;
    };
  - |
    #include <dt-bindings/clock/s32g-scmi-clock.h>
    #include <dt-bindings/mailbox/nxp-llce-mb.h>

    llce_spi2: spi@43c02000 {
        compatible = "nxp,s32g-lpspi";
        reg = <0x14 0x0 0x0 0x1000>;
        clocks = <&clks S32G_SCMI_CLK_LLCE_PER>,
                 <&clks S32G_SCMI_CLK_LLCE_SYS>;
        clock-names = "per", "ipg";
        pinctrl-0 = <&lpspi2_pins>;
        pinctrl-1 = <&lpspi2_pins_slave>;
        pinctrl-names = "default", "slave";
        interrupts-extended = <&llce_mb LLCE_MB_LPSPI_IRQ_2>;
    };
